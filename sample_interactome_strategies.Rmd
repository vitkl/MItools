---
title: 'Sample human interactome: strategies'
author: "Vitalii Kleshchevnikov"
date: "20/07/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressPackageStartupMessages({
  library(MItools)
})
```

## Intro: exploring strategies for sampling human interactome

We want to know if a specific group of proteins has chosen it's interacting partners based on the properties of those interacting partners.  
For example, viral protein can bind specific human protein because those specific human proteins contain specific domains. One of the possible ways to identify relevant features in human proteins would be to ask how the distribution of those features among human interacting parters of a viral protein changes if the viral protein is connected to a set of random human proteins.   
Viral protein may have become connected to any human protein if not for the specific features of the human protein. By taking random samples of human proteins we may be able to identify those features.   
NOTE: proteins with available interactions are sampled, not the subnetworks. Next, interacting partners of the sampled proteins are identified. We don't know how interacting partners of the sampled proteins are connected to each other.  

This analysis test two strategies of such sampling:  
1. Random sample of the defined size.
2. Random sample of the defined size and degree distribution.

## Download the data and view distributions

First, let's get some data for the starting distribution and download full human interactome.  
```{r}
if(!file.exists("./data/viral_interactions.txt")){
    queryPSICQUIC(query = "species:10239",
                format = "tab25",
                database = "imex",
                file = "./data/viral_interactions.txt")
}

all_viral_interaction = fread("./data/viral_interactions.txt", stringsAsFactors = F)

# clean the data in the table to make it more useble
all_viral_interaction = cleanMITAB(all_viral_interaction)

# filter only human-viral interactions
all_viral_interaction = all_viral_interaction[Taxid_interactor_A == "9606" | Taxid_interactor_B == "9606",]
all_viral_interaction = unique(all_viral_interaction)

# download a full set of human (9606) protein-protein interactions from IMEx databases in MITAB2.5 format, clean and select specific columns
full = fullInteractome(taxid = "9606", database = "imex", format = "tab25", clean = TRUE, protein_only = TRUE, directory = "./data/")
```

Next, let's calculate degree for each protein and the degree distribution.  

```{r, fig.height= 8, fig.width=8}
par(mfrow = c(2,2))
full_degree = edgelist2degree(full)
full_degree_dist = edgelist2degreeFreq(full)
plot(full_degree_dist$N, full_degree_dist$degree_freq, 
     log = "xy", xlim = c(1, 1000), #ylim = c(5e-05, 1),
     main = "full human interactome \n - human-human interactions -", 
     ylab = "degree frequency, log-scale",
     xlab = "degree, log-scale", 
     las=1)

# identify viral proteins
viral_proteins = unique(c(all_viral_interaction[Taxid_interactor_A != "9606", IDs_interactor_A], all_viral_interaction[Taxid_interactor_B != "9606", IDs_interactor_B]))
# calculate viral degree distribution
viral_degree_dist = edgelist2degreeFreq(all_viral_interaction, prots = viral_proteins)
plot(viral_degree_dist$N, viral_degree_dist$degree_freq, 
     log = "xy", xlim = c(1, 1000), #ylim = c(5e-05, 1),
     main = "degree distribution of viral proteins",
     ylab = "degree frequency, log-scale", 
     xlab = "degree, log-scale", 
     las=1)

# identify viral-interacting human proteins
human_viral_proteins = unique(c(all_viral_interaction[Taxid_interactor_A == "9606", IDs_interactor_A], all_viral_interaction[Taxid_interactor_B == "9606", IDs_interactor_B]))
# calculate viral-interacting human protein degree distribution (human-viral interactions)
viral_human_degree_dist = edgelist2degreeFreq(all_viral_interaction, prots = human_viral_proteins)
plot(viral_human_degree_dist$N, viral_human_degree_dist$degree_freq, 
     log = "xy", xlim = c(1, 1000), #ylim = c(5e-05, 1),
     main = "viral-interacting human proteins \n - human-viral interactions -",
     ylab = "degree frequency, log-scale", 
     xlab = "degree, log-scale", 
     las=1)

# calculate viral-interacting human protein degree distribution (human-human interactions)
viral_human_human_degree_dist = edgelist2degreeFreq(full, prots = human_viral_proteins)
plot(viral_human_human_degree_dist$N, viral_human_human_degree_dist$degree_freq, 
     log = "xy", xlim = c(1, 1000), #ylim = c(5e-05, 1),
     main = "viral-interacting human proteins \n - human-human interactions -",
     ylab = "degree frequency, log-scale", 
     xlab = "degree, log-scale", 
     las=1)
```


## Random sample: profile for speed

This analysis has identified that keeping unique interaction IDs as a pair_id character string and then using strsplit to retrieve these interactions is extremely inefficient as compared to storing IDs or interactors is separate columns: ~ 200 vs ~20ms

```{r}
profvis({
  random = randomInteractome(MITABdata = full, degree_data = full_degree, n_prot = 500, degree_dist = viral_human_human_degree_dist)
}, interval = 0.005)
profvis({
  random = randomInteractome(MITABdata = full, degree_data = full_degree, n_prot = 500)
}, interval = 0.005)
```

## Random sample: compare starting and sampled distribution
